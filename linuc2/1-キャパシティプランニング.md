# 1.キャパシティプランニング

## ポイント

* 要素ごとの監視コマンド、観測ポイント、予測ポイントを抑える
* 監視ツールの種類と特徴

### 項目ごとの調査に使うコマンド

* システム全体としてのCPU使用率
  * top
  * vmstat
  * iostat
  * mpstat -P [CPU番号|ALL]
* プロセスごとのCPU使用率
  * top
  * ps u[ax]
* 負荷平均（LA)
  * top
  * uptime
  * w
* システム全体の物理メモリ
  * top
  * free
  * vmstat
  * sar -r
* スワップ領域
  * top
  * free
  * vmstat
  * sar -S
  * swapon -s
* スワップイン/アウトの状況
  * vmstat
* ディスクI/O
  * iostat
  * iotop
  * vmstat
  * sar -b
* ディスク使用状況
  * df
* ネットワークI/O
  * iptraf
  * netstat -[i|s]
  * sar -n [DEV|EDEV]
  * ss
* ネットワークトラフィック
  * netstat
  * netserver
  * netperf
  * iptraf
* プロセスのPID
  * pstree -p
  * ps [uax]
  * top
  * lsof : ファイルを開いているプロセスを表示する


## リソース監視ツール

* collectd
* Nagios
* MRTG
* Cacti
* Ichiga2

## top

* topで確認できる項目について

## ps

**項目と意味**
| 項目 | 意味 |
| - | - |
| USER | ユーザ名|
| PID | プロセスID |
| %CPU | CPUの使用率 |
| %MEM | 物理メモリの使用率 |
| VSZ | 仮想メモリのサイズ(KB) |
| RSS | 使用中の物理メモリのサイズ(KB) |
| TTY | 制御端末名 |
| STAT | プロセスの状態と優先度 |
| START | 実行開始時刻 |
| TIME | 消費したCPU時間 |
| COMMAND | 実行コマンド |

**オプション**

* u : メモリやCPU使用率を表示する
* a :
* x :


## vmstat

* procs ： プロセスの統計情報を表示
  * r : 実行待ちプロセスの数
  * b : I/O待ちなどで割り込み不可のスリープ状態にあるプロセスの数
  * w : スワップアウトされているプロセスの数(w列が表示されない場合もある)
* memory ： メモリの使用状況を表示
  * swpd : 使用中のスワップ領域のサイズ
  * free : 空いている物理メモリのサイズ
  * buff : バッファキャッシュのサイズ
  * cache : ページキャッシュのサイズ
* swap ： スワップイン・アウトの状況を表示
  * si : スワップインされているメモリのサイズ(KB/秒)
  * so : スワップアウトされているメモリのサイズ(KB/秒)
* io ： ディスクI/Oの状態を表示
  * bi : デバイスからの読み取りブロック数/秒
  * bo : デバイスへの書き込みブロック数/秒
* system ： 割り込み回数やコンテキストスイッチ回数を表示
  * in : 1秒あたりの割り込み回数(クロック割り込み含む)
  * cs : 1秒あたりのコンテキストスイッチ回数
* cpu : CPUの使用状況を表示
  * us : ユーザプロセスの割合
  * sy : システムプロセス(カーネル)の割合
  * id : アイドル時間の割合
  * wa : I/O待ち時間の割合
  * st : バーチャルマシンに使用された時間の割合

## mpstat

## iostat

## free
メモリやスワップ領域の使用状況を表示する

* Mem 
  * total : 物理メモリの総量
  * used : 使用中の物理メモリのサイズ
  * free : 空いている物理メモリのサイズ
  * shared : 共有メモリサイズ
  * buffers : バッファキャッシュのサイズ
  * cached : ページキャッシュのサイズ
* -/+ buffers/cache
  * used : バッファキャッシュとページキャッシュを含まない、使用中の物理メモリのサイズ
  * free : バッファキャッシュとページキャッシュを含む、空いている物理メモリのサイズ
* Swap
  * total : スワップ領域の総量
  * used : 使用中のスワップ領域のサイズ
  * free : 空いているスワップ領域のサイズ

## netstat

ネットワークの状態に関する情報を表示する

* -s : プロトコル毎のパケットの統計情報

## sar
※アップデートしてまとめる

**オプション**

* -u : CPU負荷
* -P : 指定したCPUの使用率 
* -r : 物理メモリの使用状況
* -R : 
* -S : スワップ領域
* -b : ディスクI/O
* -n : ネットワークインタフェイスの送受信パケットの状況
* -f : データを取り出すログファイルの指定

**sadc**  
sadcコマンドはcronの設定により定期的に実行され、収集したバイナリデータは「/var/log/sa/saXX」ファイルに書き込む。   
定期的な実行を導入できる/usr/lib/sa/sa1,/usr/lib/sa/sa2というスクリプトが用意されており、sa1はsadcの定期的な実行を、sa2はsarの定期的な実行を設定できる。  

**sadf**  
sadc/sarコマンドで収集したデータは、sadfコマンドを使って様々な形式に変換する。
sadf [オプション] [対象データ] -- [sarのオプション]

* -j : json形式に変換
* -x : XML形式に変換
* -H : ヘッダ情報を出力する

## collected
collectdはサーバの状態を監視するデーモン  

**/etc/collected.conf**  
使用するプラグインはcollectdの設定ファイル「/etc/collectd.conf」のオプション「LoadPlugin」で指定する
