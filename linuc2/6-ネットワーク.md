# ネットワーク

## ネットワークの設定


### ネットワークデバイス

*ネットワークインタフェイス*
| インタフェイス名 | 説明 |
| - | - |
| eth0 | 1番目のイーサネットインタフェイス |
| eth1 | 2番目のイーサネットインタフェイス |
| ppp0 | 1番目のPPPインタフェイス |
| lo | ローカルループバックインタフェイス |

*インタフェイスの命名規則*
| 種別 | 説明 |
| - | - |
| en | イーサネット |
| wl | 無線LAN |
| ww | 無線WAN |

| デバイス | 説明 |
| - | - |
| オンボードデバイス | o<インデックス> |
| ホットプラグデバイス | s<スロット> |
| PCIデバイス | p<バス>s<スロット> |

* lspci
* dmesg
* ifconifg

*MACアドレス*  
ネットワークインタフェイスの、48ビットからなる一意のアドレスによって識別される識別子

### ARP

### デフォルトゲートウェイ

ルーティングにおいてデフォルトゲートウェイが複数ある場合、『メトリック』を参考に、値の小さいほうを使用する

*マルチホーム*
マルチホームとは、同一のホストにおいて、複数のインターフェイスや複数のIPアドレスなどにより、ネットワークへ接続する経路が複数ある状態。

### 管理コマンド

* ping
  * -n : 名前解決を行わない
  * -c : 何回送信するかの指定
  * -i : 送信間隔秒の指定
  * -s : 送信するパケットデータサイズの指定
* traceroute
* mtr
* netstat
  * -a : すべてのソケットを表示
  * -l : 待ち受け状態のソケットのみを表示
  * -n : 名前解決しない
  * -t : tcpソケットを表示
  * -u : udpソケットを表示
  * -c : 情報を毎秒更新する
  * -i : 統計を表示
  * -r : ルーティングテーブルを表示
* ss
  * -a : すべてのソケットを表示
  * -l : 待ち受け状態のソケットのみを表示
  * -n : 名前解決しない
  * -t : tcpソケットを表示
  * -u : udpソケットを表示
  * -i : 内部tcpの情報を表示
  * -r : 名前解決する
* nc
  * nc [オプション] ホスト ポート
  * -v : 接続に成功した際にログメッセージなどを出力する
  * -z : 接続のみを試み、データを送信することはしない
    * -vz でポートスキャンができる
* nmap
  * -sT : TCPスキャン
  * -sU : UDPスキャン
  * -sP : Ping(icmp)スキャン
  * -p : ポート範囲を指定
  * -F : 有名ポートのみを対象に高速スキャン
  * -O : 対象ホストのOS識別を試みる
* ip
  * ip [オプション] オブジェクト コマンド
  * ip route [add|del] default via ゲートウェイのIPアドレス
  * ip route del default
* ifconfig
  * ifconfig インタフェース名 操作内容
  * ifconfig eth0:1 IPアドレス
* hostname : 自身のホスト名を表示
  * -d : 自ホストのDNSドメイン名を表示
  * -i : 自ホストのIPアドレスを表示
  * -f : 自ホストのFQDNを表示
  * -a : 自ホストのエイリアスを表示

### ルーティング

* route
  * route add [-host|-net] 宛先アドレス gw ゲートウェイのIPアドレス
  * route del [-host|-net] 宛先アドレス gw ゲートウェイのIPアドレス
  * route add default gw デフォルトゲートウェイのIPアドレス
* ip

### 無線ネットワーク設定

* iw
  * iw オブジェクト コマンドs
  * iw dev [インタフェイス] : インタフェイスに関する情報の表示や設定
  * iw phy [デバイス名] : デバイスに関する情報の表示や設定
* iwconfig
* iwlist

## 高度なネットワークの設定と問題解決

### 関連ファイル

* /etc/
  * sysconfig/network : RedHat系ホスト名指定
  * sysconfig/network-scripts/ifcfg-インタフェイス名 : RedHat系デバイス別設定
  * network/interfaces : Debian系デバイス別設定
  * hostname : Debian系ホスト名設定
  * hosts : ホスト名とIPアドレス対応の設定
  * hosts.allow : アクセス許可とするホスト設定
     * サービス名 : ホスト名|IPアドレス
  * hosts.deny : アクセス拒否とするホスト設定
     * サービス名 : ホスト名|IPアドレス
  * networks : アドレス対応の設定
  * nsswitch.conf : 名前解決の優先順位
  * resolv.conf : 名前解決に使うDNSサーバの設定

**hsots.allowとhosts.denyについて**

tcpdは始めに「/etc/hosts.allow」ファイルをチェックします。条件にマッチした場合はその時点でアクセスを許可し、「/etc/hosts.deny」ファイルはチェックしません。条件にマッチしなかった場合は、「/etc/hosts.deny」ファイルをチェックします。「/etc/hosts.deny」ファイルの条件にマッチすればその時点でアクセスを拒否します。マッチしなかった場合はアクセスが許可されます。
つまり、両方のファイルに記述がない場合はアクセスが許可されることになります。通常は、「/etc/hosts.deny」ファイルに「ALL : ALL」と記述して全てのアクセスを拒否し、「/etc/hosts.allow」ファイルで接続を許可する設定を行います。

### 疎通確認と名前解決の確認

* traceroute
* tracepath
* mtr
* ifconfig
  * ifup

### tcpdump

tcpdumpの出力例とその意味の確認

Wireshark

* オプション
  * -i : 監視対象とするインタフェイスを指定する
  * -n : 名前解決を行わない
  * -X : 16進数とASCIIの表でパケットの内容を表示する

* 監視対象
  * host : 対象ホストを指定
  * port : ポート番号を指定
  * tcp : tcpのパケットを対象とする
  * udp : udpのパケットを対象とする
  * icmp : icmpのパケットを指定する
  * arp : arpのパケットを指定する
  * src : 送信元のホストを指定する
  * dst : 宛先のホストを指定する